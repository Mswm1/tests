<head>
    <meta name=viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{url_for('static',filename='styles.css')}}">
</head>

<body>
   <div class="container">
    <h2>Transfer Money</h2>
       <input type="text" id="payer" placeholder="Payer Address">
       <input type="text" id="payee" placeholder="Payee Address">
       <input type="number" id="amount" placeholder="Amount">
       <button class="btn" onclick="transfer()">Transfer</button>
       <button class="btn" onclick="view_transaction()">View Transaction</button>
       <p id="view_Payer"></p>
       <p id="view_Payee"></p>
       <p id="view_Amount"></p>
       <form action="/main" method="POST">
           <input type="submit" value="Main">
       </form>
       <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
       <script>
           const contractAddress="0xc47e45796fd8fb7004dd237dca0a21003dff9671";
           const contractABI=
[
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "payer_input",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "payee_input",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount_input",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "transfer_view",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
           ];
           const web3= new Web3(Web3.givenProvider);
           const contract=new web3.eth.Contract(contractABI,contractAddress);
           async function transfer(){
               const accounts = await web3.eth.requestAccounts();
               const payer=document.getElementById('payer').value;
               const payee=document.getElementById('payee').value;
               const amount = document.getElementById('amount').value;
               console.log(payer);
               console.log("account[0]" + accounts[0]);
               await contract.methods.transfer(payer,payee,amount).send({from: accounts[0]});
           };
           async function view_transaction(){
               const result = await contract.methods.transfer_view().call();
               console.log(result);
               const payerAddress = result[0];
               const payeeAddress = result[1];
               const amount = result[2];
               document.getElementById('view_Payer').innerText="Payer：" + payerAddress;
               document.getElementById('view_Payee').innerText="Payee：" + payeeAddress;
               document.getElementById('view_Amount').innerText="Amount：" + amount;

           }
       </script>
   </div>
</body>